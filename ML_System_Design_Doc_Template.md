# ML System Design Doc - [RU]
## Дизайн ML системы - \<Автоматизаци определения ориентации железнодорожных вагонов\> \<MVP or Production System\> \<Номер\>

## 1. Цели и предпосылки

### 1.1. Зачем идем в разработку продукта?

**Бизнес-цель (Product Owner)**
Стратегическая цель - повышение операционной эффективности диспетчерской службы за счет автоматизации процесса идентификации ориентации подвижного состава. Внедрение ML-решения позволит:
- Сократить время обработки видеопотока на 85% (с 15 минут до 2 минут на состав)
- Исключить человеческий фактор при определении ориентации (текущий уровень ошибок - 7.3%)
- Обеспечить круглосуточный мониторинг без привлечения дополнительного персонала

**Почему станет лучше, чем сейчас (Product Owner & Data Scientist)**


*Текущее состояние:*
- Ручной анализ видеозаписей операторами
- Субъективность оценки при плохой видимости
- Отсутствие единой базы данных ориентации вагонов
- Невозможность масштабирования без увеличения штата

*Целевое состояние:*
- Автоматическая детекция референтных объектов в реальном времени
- Объективная оценка с доверительной вероятностью >95%
- Интеграция с существующей системой мониторинга через REST API
- Масштабируемость на любой полигон без дополнительных затрат

**Критерии успеха итерации (Product Owner)**
1. Достижение точности определения (Accuracy) ≥ 92% на валидационной выборке
2. Время инференса ≤ 150 мс на кадр (Ryzen 5 3600)


### 1.2. Бизнес-требования и ограничения

**Детальные бизнес-требования**
| ID | Требование |
|----|------------|
| БТ-01 | Система должна определять ориентацию вагона с точностью ≥90% |
| БТ-02 | Время обработки одного вагона ≤ 30 сек |
| БТ-03 | Работа в условиях ограниченной видимости (ночь, осадки) |
| БТ-04 | Интеграция с АСУ "Транс-Телематика" через API |


**Бизнес-ограничения**
1. **Технические:**
   - Частота кадров видеопотока: 25 fps (фиксировано)
   - Разрешение камер: 1920x1080 или 1280x720

2. **Нормативные:**
   - Соответствие 152-ФЗ "О персональных данных"
   - Соблюдение политики информационной безопасности заказчика

**Ожидания от итерации**
1. Рабочий прототип ML-модели (Docker-контейнер)
2. Техническая документация
3. Отчет по результатам тестирования на исторических данных
4. План пилотного внедрения с метриками эффективности

### 1.3. Что входит в скоуп проекта/итерации

**Включено в итерацию (Data Scientist)**
| Компонент | Описание | Критерий готовности |
|-----------|----------|---------------------|
| Data Pipeline | ETL процесс для сбора и разметки данных | Автоматизация загрузки, 95% coverage |
| ML Model | Модель детекции объектов | mAP@0.5 ≥ 0.95 |
| Rule Engine | Алгоритм принятия решения об ориентации | Accuracy ≥ 92% |
| API Service | REST API с эндпоинтами для инференса | OpenAPI spec, тесты |
| Monitoring | Базовый мониторинг метрик | Дашборд в Grafana |

**Исключено из итерации**
1. Разработка UI/UX интерфейса
2. Мобильное приложение
3. Система автоматического ретрейнинга


**Требования к качеству кода**
```python
# Стандарты разработки
- MyPy (строгая типизация)
- flake8, isort, pylint, black
- Pytest (coverage ≥ 70%)
- Pre-commit хуки
```


### 1.4. Предпосылки решения

**Данные и обоснование выбора**
| Параметр | Значение | Обоснование |
|----------|----------|-------------|
| Источники данных | Видеопоток с камер, метаданные вагонов | Доступность, репрезентативность |
| Объем выборки | ≥ 15 000 размеченных кадров | Статистическая значимость |
| Горизонт прогноза | 3-5 секунд (один вагон) | Скорость прохода состава |
| Гранулярность | Покадровая с агрегацией | Баланс точности и скорости |
| Частота обновления | Ежеквартально | Стабильность условий съемки |

**Научно-техническое обоснование**
1. **Выбор архитектуры:** Сверточные нейросети (CNN) доказали свою эффективность в задачах детекции промышленных объектов (YOLOv11)
2. **Аугментация данных:** Учет специфики железнодорожного транспорта (снег, дождь, засветы)

